<script src="esprima.js"></script>
<script>
	var phantomExit = function(result) {
		if (window.callPhantom)
			window.callPhantom(result);
		else
		{
			console.log(result);
			console.error('UnityTwine: PhantomJS context not available.');
		}
	};

	var simplify = function(obj) {
		
		var result = null;

		if (Array.isArray(obj))
		{
			result = [];
			for (var i = 0; i < obj.length; i++)
				result.push(simplify(obj[i]));
		}
		else if (typeof(object) === "object")
		{
			result = {};
			for(var field in obj)
				if (obj.hasOwnProperty(field))
					result[field] = simplify(obj[field]);
		}
		else if (typeof(object) === "function")
		{

		}
		else
			result = obj;

		return result;
	}

	var urlParts = window.location.href.split('?', 2);
	
	var result = null;
	if (urlParts.length > 1)
	{
		var raw = esprima.parse(decodeURIComponent(urlParts[1]));
		result = simplify(result);
	}

	phantomExit(result);
</script>